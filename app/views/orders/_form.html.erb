<%= form_with(model: order,url: customer_orders_path(@customer), method: :post) do |form| %>
  <% if order.errors.any? %>
    <div style="color: red">
      <h2><%= pluralize(order.errors.count, "error") %> prohibited this order from being saved:</h2>

      <ul>
        <% order.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <% if current_customer? && current_user.customer.addresses.present? %>
    <!-- 如果有地址，显示下拉列表 -->
    <div class="form-group">
      <%= form.label :address, "选择地址" %>
      <%= form.collection_select(:address_id, current_user.customer.addresses, :id, :full_address, { prompt: "请选择地址" }, { class: "form-control", required: true }) %>
    </div>
  <% else %>
    <h2>
      您还没有地址，请先添加一个收货地址
    </h2>
    <!-- 如果没有地址，显示地址表单 -->
    <%= form.fields_for :address, Address.new do |address_fields| %>

      <div class="form-group">
        <%= address_fields.label :country, class: "control-label" %>
        <%= address_fields.text_field :country, class: "form-control", placeholder: "国家" %>
      </div>
      <div class="form-group">
        <%= address_fields.label :city, class: "control-label" %>
        <%= address_fields.text_field :city, class: "form-control", placeholder: "城市" %>
      </div>
      <div class="form-group">
        <%= address_fields.label :house_address, class: "control-label" %>
        <%= address_fields.text_field :house_address, class: "form-control", placeholder: "具体地址" %>
      </div>

      <div class="form-group">
        <%= address_fields.label :phone_number, class: "control-label" %>
        <%= address_fields.text_field :phone_number, class: "form-control", placeholder: "联系电话" %>
      </div>

      <div class="form-group">
        <%= address_fields.label :greeting_name, class: "control-label" %>
        <%= address_fields.text_field :greeting_name, class: "form-control", placeholder: "收货人称呼" %>
      </div>

      <!-- 其他地址字段，按照需要添加 -->

    <% end %>
  <% end %>


  <div class="mb-3">
    <%= form.label :count , class: "form-label"%>
    <%= form.number_field :count , class: "form-control", id: "countField",placeholder: "购买数量"%>
  </div>

  <div class="mb-3">
    <%= form.label :price , class: "form-label"%>
    <%= form.text_field :price , class: "form-control form-control-textarea", id: "displayTotalPrice", disabled: true, data: { price: @price } %>
  </div>


  <%= form.hidden_field :customer_id, value: params[:customer_id] %>
  <%= form.hidden_field :commodity_id, value: params[:commodity_id] %>
  <%= form.hidden_field :done, value: params[:done] %>
<!--  <div class="mb-3">加一个备注-->
    <%#= form.label :info , class: "form-label"%>
    <%#= form.text_area :info , class: "form-control form-control-textarea"%>
<!--  </div>-->

  <div>
    <%= form.submit "确认", class: "btn btn-primary"%>
  </div>
<% end %>

<script>
    // 获取count和price字段的元素
    let countField = document.getElementById('countField');

    // 获取用于显示的元素
    let displayTotalPrice = document.getElementById('displayTotalPrice');

    // 添加事件监听器
    countField.addEventListener('input', updateTotal);

    // 更新总价显示
    function updateTotal() {
        let count = parseInt(countField.value) || 0; // 确保输入是数字
        let price = parseFloat(displayTotalPrice.dataset.price) || 0;
        // 计算总价
        let total = count * price;
        // 更新显示
        displayTotalPrice.textContent = total.toFixed(2); // 保留两位小数
    }
</script>