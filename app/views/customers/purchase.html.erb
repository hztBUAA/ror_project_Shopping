<%= form_with(model: @order,url: customer_orders_path(@customer), method: :post) do |form| %>
  <% if @order.errors.any? %>
    <div style="color: red">
      <h2><%= pluralize(@order.errors.count, "error") %> prohibited this order from being saved:</h2>

      <ul>
        <% @order.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- 显示商品图片 -->
  <div class="mb-3">
    <%#= form.label :image, class: "form-label" %>
    <%= image_tag @commodity&.image, class: "img-fluid", alt: "Commodity Image" %>
  </div>
  <!-- 显示商品名字 -->
  <h2><%= @commodity.commodity_name %></h2>
    <!-- 如果有地址，显示下拉列表 -->
    <div class="form-group">
      <%= form.label :address, "选择地址" %>
      <%= form.collection_select(:address_id, current_user.customer.addresses, :id, :full_address, { prompt: "请选择地址" }, {class: "form-control",required: true}) %>
    </div>


  <div class="mb-3">
    <%= form.label :count , class: "form-label"%>
    <%= form.number_field :count , class: "form-control", id: "countField"%>
  </div>

  <div class="mb-3">
    <%= form.label :price , class: "form-label"%>
    <%= form.text_field :price , value: "￥"+@price.to_s, class: "form-control ", id: "displayTotalPrice", disabled: true %>
  </div>


  <%= form.hidden_field :customer_id, value: params[:customer_id] %>
  <%= form.hidden_field :commodity_id, value: params[:commodity_id] %>
  <%= form.hidden_field :done, value: params[:done] %>
  <!--  <div class="mb-3">加一个备注-->
  <%#= form.label :info , class: "form-label"%>
  <%#= form.text_area :info , class: "form-control form-control-textarea"%>
  <!--  </div>-->

  <div>
    <%= form.submit "确认", class: "btn btn-primary"%>
  </div>
<% end %>
<!-- 在你的视图文件底部添加以下 JavaScript 代码 -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    jQuery(document).ready(function($) {
        $('#countField').on('input', function() {
            var count = $(this).val();
            var totalPrice = count * <%= @price %>;
            $('#displayTotalPrice').val("￥" + totalPrice.toFixed(2));
        });
    });
</script>